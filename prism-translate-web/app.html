<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRISM Translate - App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-text {
            background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .typing-indicator {
            display: inline-block;
            width: 8px;
            height: 20px;
            background: #6366F1;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        .language-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236B7280' d='M10.293 3.293L6 7.586 1.707 3.293A1 1 0 00.293 4.707l5 5a1 1 0 001.414 0l5-5a1 1 0 10-1.414-1.414z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            padding-right: 2rem;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen overflow-hidden">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 h-16 flex items-center px-6">
        <div class="flex items-center justify-between w-full">
            <div class="flex items-center space-x-8">
                <h1 class="text-2xl font-bold gradient-text">PRISM</h1>
                <nav class="hidden md:flex space-x-6">
                    <button class="text-gray-600 hover:text-gray-900 font-medium">Dịch văn bản</button>
                    <button class="text-gray-600 hover:text-gray-900 font-medium">Dịch tài liệu</button>
                    <button class="text-gray-600 hover:text-gray-900 font-medium">Lịch sử</button>
                </nav>
            </div>
            <div class="flex items-center space-x-4">
                <button class="text-gray-600 hover:text-gray-900">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full"></div>
                    <span class="text-sm font-medium">Lam Nguyen</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex h-[calc(100vh-4rem)]">
        <!-- Left Panel - Input -->
        <div class="w-1/2 bg-white border-r border-gray-200 flex flex-col">
            <!-- Language Selector -->
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <select class="language-select px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="auto">Tự động phát hiện</option>
                            <option value="vi">Tiếng Việt</option>
                            <option value="en">English</option>
                            <option value="zh">中文</option>
                            <option value="ja">日本語</option>
                            <option value="ko">한국어</option>
                            <option value="fr">Français</option>
                            <option value="de">Deutsch</option>
                            <option value="es">Español</option>
                        </select>
                        <button class="p-2 hover:bg-gray-100 rounded-lg" title="Hoán đổi ngôn ngữ">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                            </svg>
                        </button>
                        <select class="language-select px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="en">English</option>
                            <option value="vi">Tiếng Việt</option>
                            <option value="zh">中文</option>
                            <option value="ja">日本語</option>
                            <option value="ko">한국어</option>
                            <option value="fr">Français</option>
                            <option value="de">Deutsch</option>
                            <option value="es">Español</option>
                        </select>
                    </div>
                    <div class="text-sm text-gray-500">
                        <span id="charCount">0</span> / 5,000 ký tự
                    </div>
                </div>
            </div>

            <!-- Text Input Area -->
            <div class="flex-1 p-4">
                <textarea 
                    id="inputText"
                    class="w-full h-full resize-none border-none outline-none text-lg"
                    placeholder="Nhập văn bản cần dịch hoặc dán nội dung vào đây..."
                    oninput="handleInput()"
                ></textarea>
            </div>

            <!-- Bottom Toolbar -->
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <button class="p-2 hover:bg-gray-100 rounded-lg" title="Nhập bằng giọng nói" onclick="startVoiceInput()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>
                        </button>
                        <button class="p-2 hover:bg-gray-100 rounded-lg" title="Upload file" onclick="document.getElementById('fileInput').click()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                            </svg>
                        </button>
                        <input type="file" id="fileInput" class="hidden" accept=".txt,.pdf,.docx" onchange="handleFileUpload(event)">
                    </div>
                    <button 
                        onclick="clearInput()"
                        class="text-gray-500 hover:text-gray-700"
                    >
                        Xóa tất cả
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Panel - Output -->
        <div class="w-1/2 bg-gray-50 flex flex-col">
            <!-- Translation Status -->
            <div class="p-4 border-b border-gray-200 bg-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div id="translationStatus" class="text-sm text-gray-600">
                            Sẵn sàng dịch
                        </div>
                        <div id="loadingIndicator" class="hidden">
                            <svg class="animate-spin h-4 w-4 text-indigo-600" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="p-2 hover:bg-gray-100 rounded-lg" title="Copy" onclick="copyTranslation()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                            </svg>
                        </button>
                        <button class="p-2 hover:bg-gray-100 rounded-lg" title="Download" onclick="downloadTranslation()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </button>
                        <button class="p-2 hover:bg-gray-100 rounded-lg" title="Text-to-Speech" onclick="speakTranslation()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Translation Output -->
            <div class="flex-1 p-4 bg-white">
                <div id="translationOutput" class="text-lg text-gray-600">
                    <p class="text-gray-400">Bản dịch sẽ xuất hiện ở đây...</p>
                </div>
            </div>

            <!-- AI Suggestions -->
            <div id="aiSuggestions" class="p-4 border-t border-gray-200 bg-indigo-50 hidden">
                <div class="flex items-start space-x-2">
                    <svg class="w-5 h-5 text-indigo-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div class="flex-1">
                        <p class="text-sm text-indigo-800 font-medium">Gợi ý từ AI:</p>
                        <p class="text-sm text-indigo-700 mt-1" id="aiSuggestionText"></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Voice Input Modal -->
    <div id="voiceModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full">
            <div class="text-center">
                <div class="w-20 h-20 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold mb-2">Đang ghi âm...</h3>
                <p class="text-gray-600 mb-4">Nói rõ ràng để có kết quả tốt nhất</p>
                <div class="flex justify-center space-x-4">
                    <button onclick="stopVoiceInput()" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                        Dừng ghi
                    </button>
                    <button onclick="cancelVoiceInput()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                        Hủy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'https://web-production-87be0.up.railway.app';
        let translationTimeout;
        let currentTranslation = '';

        // Handle input and trigger translation
        function handleInput() {
            const input = document.getElementById('inputText');
            const charCount = document.getElementById('charCount');
            charCount.textContent = input.value.length;

            // Clear previous timeout
            clearTimeout(translationTimeout);

            // Set new timeout for translation (debounce)
            if (input.value.trim()) {
                document.getElementById('translationStatus').textContent = 'Đang gõ...';
                translationTimeout = setTimeout(() => {
                    translateText(input.value);
                }, 500);
            } else {
                document.getElementById('translationOutput').innerHTML = '<p class="text-gray-400">Bản dịch sẽ xuất hiện ở đây...</p>';
                document.getElementById('translationStatus').textContent = 'Sẵn sàng dịch';
            }
        }

        // Translate text using API
        async function translateText(text) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const translationStatus = document.getElementById('translationStatus');
            const translationOutput = document.getElementById('translationOutput');
            const aiSuggestions = document.getElementById('aiSuggestions');

            // Show loading
            loadingIndicator.classList.remove('hidden');
            translationStatus.textContent = 'Đang dịch với AI...';

            try {
                // Call AI Commander API
                const response = await fetch(`${API_URL}/api/v1/ai-commander/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Translate this text to English: ${text}`,
                        session_id: 'translate-' + Date.now()
                    })
                });

                const data = await response.json();

                // Update translation output
                currentTranslation = data.response || 'Translation result here...';
                translationOutput.innerHTML = `<p>${currentTranslation}</p>`;

                // Show AI suggestions if available
                if (data.suggestions && data.suggestions.length > 0) {
                    aiSuggestions.classList.remove('hidden');
                    document.getElementById('aiSuggestionText').textContent = data.suggestions[0];
                }

                translationStatus.textContent = 'Dịch hoàn tất';
            } catch (error) {
                console.error('Translation error:', error);
                
                // Fallback mock translation
                currentTranslation = `[Translated] ${text}`;
                translationOutput.innerHTML = `<p>${currentTranslation}</p>`;
                translationStatus.textContent = 'Dịch hoàn tất (offline mode)';
            }

            loadingIndicator.classList.add('hidden');
        }

        // Clear input
        function clearInput() {
            document.getElementById('inputText').value = '';
            document.getElementById('charCount').textContent = '0';
            document.getElementById('translationOutput').innerHTML = '<p class="text-gray-400">Bản dịch sẽ xuất hiện ở đây...</p>';
            document.getElementById('translationStatus').textContent = 'Sẵn sàng dịch';
            document.getElementById('aiSuggestions').classList.add('hidden');
        }

        // Copy translation
        function copyTranslation() {
            if (currentTranslation) {
                navigator.clipboard.writeText(currentTranslation);
                
                // Show toast notification
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg';
                toast.textContent = 'Đã copy vào clipboard!';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
        }

        // Download translation
        function downloadTranslation() {
            if (currentTranslation) {
                const blob = new Blob([currentTranslation], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'translation-' + Date.now() + '.txt';
                a.click();
                window.URL.revokeObjectURL(url);
            }
        }

        // Text-to-speech
        function speakTranslation() {
            if (currentTranslation && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(currentTranslation);
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            }
        }

        // Voice input
        let recognition;
        function startVoiceInput() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'vi-VN';

                recognition.onresult = (event) => {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    document.getElementById('inputText').value = transcript;
                    handleInput();
                };

                recognition.start();
                document.getElementById('voiceModal').classList.remove('hidden');
            } else {
                alert('Trình duyệt không hỗ trợ nhập giọng nói');
            }
        }

        function stopVoiceInput() {
            if (recognition) {
                recognition.stop();
            }
            document.getElementById('voiceModal').classList.add('hidden');
        }

        function cancelVoiceInput() {
            if (recognition) {
                recognition.stop();
            }
            document.getElementById('voiceModal').classList.add('hidden');
        }

        // File upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('inputText').value = e.target.result;
                    handleInput();
                };
                reader.readAsText(file);
            }
        }

        // Language swap
        function swapLanguages() {
            // Implementation for swapping languages
            console.log('Swap languages');
        }
    </script>
</body>
</html>